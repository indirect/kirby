#!/bin/bash
set -euo pipefail

if [[ ! $(which x86_64-unknown-linux-musl-gcc) ]]; then
  brew tap messense/macos-cross-toolchains
  brew install x86_64-unknown-linux-musl
fi

if [[ ! $(which cross) ]]; then
  cargo install cross
fi

export CC_x86_64_unknown_linux_musl="x86_64-unknown-linux-musl-gcc"
export CARGO_TARGET_X86_64_UNKNOWN_LINUX_MUSL_LINKER="x86_64-unknown-linux-musl-gcc"
cross build --target x86_64-unknown-linux-musl --release
